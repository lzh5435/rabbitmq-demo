package test.liuzehua.rabbitmqdemo.singlequeue;import com.rabbitmq.client.*;import org.junit.jupiter.api.Test;import java.io.IOException;import java.util.concurrent.TimeUnit;import java.util.concurrent.TimeoutException;/** * @author liuzehua * 2020/6/6 **/public class Consumer {    @Test    void testReceiveMessage() throws IOException, TimeoutException, InterruptedException {        ConnectionFactory connectionFactory = new ConnectionFactory();        connectionFactory.setHost("192.168.81.166");        connectionFactory.setPort(5672);        connectionFactory.setVirtualHost("/");        connectionFactory.setUsername("name");        connectionFactory.setPassword("passwd");        Connection connection = connectionFactory.newConnection();        Channel channel = connection.createChannel();        channel.queueDeclare("hello",true,false,false,null);//        DeliverCallback deliverCallback = (consumerTag, delivery) -> {//            String message = new String(delivery.getBody(), "UTF-8");//            System.out.println(" [x] Received '" + message + "'");//        };////        // 消费那个队列  开启自动确认//        channel.basicConsume("hello", true, deliverCallback, consumerTag -> {//            System.out.println("shoudao ");//        });        DefaultConsumer consumer  =new DefaultConsumer(channel){            @Override            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException {                System.out.println("================"+new String(body));                channel.basicAck(envelope.getDeliveryTag(),true);            }        };        /**         * 回调         */        channel.basicConsume("hello", true,consumer);        TimeUnit.SECONDS.sleep(5);//        channel.close();//        connection.close();    }}